<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Draws Remaining</title>
  <style>
    :root { --bg:#0b0b0f; --fg:#ffffff; --muted:#9aa3af; --accent:#22c55e; }
    html, body { height: 100%; }
    body {
      margin: 0; background: var(--bg); color: var(--fg);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      display: grid; place-items: center; padding: 24px;
    }
    .card {
      width: min(720px, 92vw);
      border-radius: 24px; padding: 28px 24px 22px; box-sizing: border-box;
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      box-shadow: 0 10px 30px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.05);
      backdrop-filter: blur(6px);
      text-align: center;
    }
    .title { font-size: clamp(18px, 3vw, 22px); letter-spacing: 0.02em; color: var(--muted); margin: 0 0 10px; }
    .value { font-variant-numeric: tabular-nums; line-height: 1; margin: 12px 0 4px; }
    .value span {
      display: inline-block;
      font-weight: 800; letter-spacing: -0.02em;
      font-size: clamp(64px, 16vw, 160px);
      padding: 10px 16px; border-radius: 20px;
      background: radial-gradient(120% 120% at 50% 0%, rgba(34,197,94,0.25), rgba(34,197,94,0.06));
      box-shadow: inset 0 2px 10px rgba(34,197,94,0.25);
    }
    .subtitle { margin-top: 8px; font-size: clamp(14px, 3.2vw, 18px); color: var(--muted); }
    .meta { margin-top: 14px; font-size: clamp(12px, 2.6vw, 14px); color: var(--muted); }
    .bad { color: #ef4444; }
    .ok { color: #f59e0b; }
    .good { color: #22c55e; }
    .hint { margin-top: 14px; opacity: .6; font-size: 12px; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <main class="card" role="region" aria-label="Draws remaining">
    <h1 class="title">Draws Remaining</h1>
    <div class="value" aria-live="polite"><span id="counter">—</span></div>
    <div id="status" class="subtitle">&nbsp;</div>
    <div id="updated" class="meta">last update: —</div>
    <div id="hint" class="hint">Tip: encode values in the URL like <code>?left=23&total=100&ts=2025-09-05T23:45:12+09:00</code></div>
  </main>

  <script>
    (function(){
      const $ = (id)=>document.getElementById(id);

      function parseParams(){
        const params = new URLSearchParams(location.search || location.hash.replace(/^#/, '?'));
        // Allow multiple aliases for convenience
        const left = parseInt(params.get('left') ?? params.get('remain') ?? params.get('remaining') ?? params.get('xx'), 10);
        const used = parseInt(params.get('used') ?? params.get('drawn'), 10);
        const total = parseInt(params.get('total') ?? params.get('tot') ?? '100', 10);
        // If used provided but not left, derive left
        const remaining = Number.isFinite(left) ? left : (Number.isFinite(used) ? Math.max(total - used, 0) : NaN);
        const tsRaw = params.get('ts');
        return { remaining, total, tsRaw };
      }

      function fmtDate(d){
        // Always show in Asia/Tokyo per requirement
        return new Intl.DateTimeFormat('en-GB', {
          timeZone: 'Asia/Tokyo', year: 'numeric', month: '2-digit', day: '2-digit',
          hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false
        }).format(d).replace(/\//g, ':').replace(/,\s*/,' ');
      }

      function update(){
        const { remaining, total, tsRaw } = parseParams();
        const valid = Number.isFinite(remaining) && Number.isFinite(total) && total > 0 && remaining >= 0;
        const counterEl = $('counter');
        const statusEl = $('status');
        const updatedEl = $('updated');
        const hintEl = $('hint');

        if (!valid) {
          counterEl.textContent = '—';
          statusEl.innerHTML = '<span class="bad">Missing values</span>'; 
          updatedEl.textContent = 'last update: —';
          hintEl.classList.remove('hidden');
          return;
        }

        counterEl.textContent = `${remaining}/${total}`;
        const ratio = remaining / total;
        statusEl.innerHTML = ratio === 0 ? '<span class="bad">Sold out</span>' : (ratio <= 0.15 ? '<span class="ok">Almost gone</span>' : '<span class="good">Available</span>');
        hintEl.classList.add('hidden');

        // Timestamp: if provided in URL (?ts=ISO), use that; else use now.
        let dt;
        if (tsRaw) {
          const parsed = new Date(tsRaw);
          dt = isNaN(parsed.getTime()) ? new Date() : parsed;
        } else {
          dt = new Date();
        }
        updatedEl.textContent = `last update: ${fmtDate(dt)}`;
      }

      // React to URL changes so you can update the display just by changing query/hash
      window.addEventListener('hashchange', update);
      window.addEventListener('popstate', update);
      update();
    })();
  </script>
</body>
</html>
